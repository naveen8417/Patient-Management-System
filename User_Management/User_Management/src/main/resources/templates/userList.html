<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointments</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f0f8ff;
        }
        .container {
            margin-top: 50px;
            position: relative; /* Ensure positioning context for absolute positioning */
        }
        .back-button {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 999; /* Ensure visibility above other elements */
        }
        h2 {
            color: deepskyblue; /* Changed to light sky blue */
            text-align: center;
            margin-bottom: 30px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: deepskyblue; /* Changed to light sky blue */
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .pagination {
            justify-content: center; /* Center pagination horizontally */
            margin-top: 20px; /* Add margin on top */
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="btn btn-primary back-button" onclick="goBack()">Back</button> <!-- Back button -->
        <h2>Appointments</h2>
        <!-- Search form -->
        <form class="form-inline mb-3" id="searchForm">
            <input type="text" class="form-control mr-sm-2" id="searchInput" placeholder="Search">
            <button type="button" class="btn btn-primary" onclick="search()">Search</button>
        </form>
        <!-- Appointments table -->
        <table class="table">
            <thead>
                <tr>
                    <th>Doctor ID</th>
                    <th>Doctor Name</th>
                    <th>Patient ID</th>
                    <th>Patient Name</th>
                    <th>Date</th>
                    <th>Slot</th>
                    <th>Approval</th>
                </tr>
            </thead>
            <tbody id="pendingAppointmentsTableBody">
                <!-- Rows will be dynamically added here -->
            </tbody>
        </table>
        <!-- Pagination -->
        <ul class="pagination" id="pagination"></ul>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        // Function to go back
       function goBack() {
        window.location.href = 'http://localhost:8888/disease/';
    }


        $(document).ready(function() {
            // Fetch pending appointments from backend API
            $.ajax({
                url: '/user/getAllPatients', // Endpoint to fetch patients from Spring MVC controller
                method: 'GET',
                success: function(data) {
                    // Check if data is defined and it's an array
                    if (Array.isArray(data)) {
                        // Display the appropriate rows based on pagination
                        displayAppointments(data);

                        // Add pagination after fetching the data
                        addPagination(data);
                    } else {
                        console.error('Received data is not an array:', data);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error fetching patients:', error);
                }
            });
        });

        // Function to display appointments based on pagination
       // Function to display appointments based on pagination
function displayAppointments(data) {
    $('#pendingAppointmentsTableBody').empty(); // Clear existing rows
    data.forEach(function(patient) {
        // Check if status is null and set it to "waiting"
        const status = patient.status ? patient.status : "waiting";

        // Create a row for the current patient object
        const row = `
            <tr>
                <td>${patient.doctorid}</td>
                <td>${patient.doctorName}</td>
                <td>${patient.id}</td>
                <td>${patient.patientName}</td>
                <td>${patient.date}</td>
                <td>${patient.slot}</td>
                <td id="approval-${patient.bookingid}">${status}</td>
            </tr>
        `;
        // Append the row to the table body
        $('#pendingAppointmentsTableBody').append(row);
    });
}

        // Function to add pagination
        function addPagination(data) {
            var totalPages = Math.ceil(data.length / 5); // Assuming 5 rows per page
            var pagination = $('#pagination');
            for (var i = 1; i <= totalPages; i++) {
                var li = $('<li class="page-item"><a class="page-link" href="#">' + i + '</a></li>');
                pagination.append(li);
            }
        }

        // Function to perform search
        function search() {
            var searchText = $('#searchInput').val().toLowerCase(); // Get the search input value and convert to lowercase
            $('#pendingAppointmentsTableBody tr').filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(searchText) > -1); // Toggle the visibility of rows based on search text
            });
        }
    </script>
</body>
</html>
